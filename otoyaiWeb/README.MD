# otoyaiWeb

**Visual node graph interface for OTOY.AI model endpoints**

Alternative UI for [play.otoy.ai](https://play.otoy.ai) that replaces form-based workflows with an Octane Render-inspired node graph editor.

---

## Overview

otoyaiWeb provides a professional node-based workflow editor for AI generation. Connect text prompts, images, videos, and AI models visually to create complex generation pipelines.

### Key Features

- **ğŸ¨ Visual Node Graph** - Drag-and-drop interface powered by React Flow
- **ğŸ¤– AI Model Nodes** - FLUX.1, Stable Diffusion, Kling Video, GPT-4o, and more
- **ğŸ¯ Type-Safe Connections** - Color-coded pins based on data types (string, int, float, image, video, audio)
- **ğŸ‘ï¸ Live Previews** - See outputs directly in nodes (planned)
- **ğŸ¬ Octane-Style UI** - Dark theme matching beta.otoy.ai aesthetic
- **ğŸ“ Smart Inspector** - Context-aware parameter editing in right panel
- **ğŸ”„ Hot Module Reload** - Instant updates during development

---

## Tech Stack

| Layer | Technology |
|-------|-----------|
| **Frontend** | React 18 + TypeScript + Vite |
| **Node Graph** | React Flow v12 (@xyflow/react) |
| **State Management** | Zustand |
| **Backend** | Node.js + Express |
| **Styling** | CSS Modules |
| **API** | OTOY.AI REST endpoints |
| **Logging** | Custom file-based logger |

---

## Project Structure

```
otoyaiWeb/
â”œâ”€â”€ client/                          # React frontend (Vite)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ Layout/             # Toolbar, Inspector, NodeBar
â”‚   â”‚   â”‚   â””â”€â”€ Nodes/              # Node components + styling
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ api.ts              # OTOY.AI API client
â”‚   â”‚   â”‚   â””â”€â”€ logger.ts           # File logging service
â”‚   â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”‚   â””â”€â”€ index.ts            # TypeScript definitions
â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”‚   â”œâ”€â”€ connectionValidator.ts  # Pin type system
â”‚   â”‚   â”‚   â””â”€â”€ endpointSchema.ts       # AI model schemas
â”‚   â”‚   â”œâ”€â”€ App.tsx                 # Main React Flow app
â”‚   â”‚   â””â”€â”€ main.tsx                # Entry point
â”‚   â”œâ”€â”€ public/
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ server/                          # Express backend
â”‚   â”œâ”€â”€ server.ts                   # API proxy + endpoint fetching
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ logs/                           # Runtime logs (git-ignored)
â”œâ”€â”€ README.md                       # This file
â”œâ”€â”€ quickstart.md                   # Installation & running
â””â”€â”€ repro_prompt.md                 # AI assistant context loader
```

---

## Color-Coded Pin System

Visual type system inspired by Octane Render's node editor:

### Parameter Types (Inputs)
- **ğŸŸ  Orange** `#ffaa44` - String (prompts, text)
- **ğŸŸ¡ Yellow** `#ffdd44` - Integer (steps, seed, width, height)
- **ğŸ”µ Cyan** `#00ddff` - Float (guidance_scale, temperature, cfg)
- **ğŸ”´ Red** `#ff4444` - Boolean (flags, toggles)
- **ğŸŸ£ Purple** `#cc44ff` - Enum (scheduler, sampler, style)

### Media Types (Same Color for Input & Output)
- **ğŸŸ¢ Green** `#44ff44` - Image
- **ğŸŸ¡ Magenta** `#ff44ff` - Video
- **ğŸ”µ Blue** `#4499ff` - Audio
- **ğŸ”· Teal** `#44ffdd` - JSON
- **âšª Gray** `#aaaaaa` - Any

**Key Design:** Media types use identical colors for inputs and outputs, making valid connections visually obvious. A green image output connects to a green image input.

---

## Node Types

### Utility Nodes
- **Text Input** - Editable text/prompt source with orange output
- **Image** - Image upload/URL input with green output
- **Video** - Video upload/URL input with magenta output

### AI Endpoint Nodes
Dynamically generated from play.otoy.ai API with:
- **Text-to-Image** - FLUX.1 [Dev], FLUX.1 [Schnell], AuraFlow, etc.
- **Image-to-Image** - FLUX.1 [Dev], style transfer models
- **Image-to-Video** - CogVideoX, Kling Video, etc.
- **LLM** - GPT-4o, Claude, Gemini (text generation)
- **Audio** - Text-to-speech, audio generation models

All AI nodes have color-coded inputs matching parameter types.

---

## Development Commands

```bash
# Start full stack (recommended)
npm run dev                # Client (Vite) + Server (Express)

# Individual services
npm run dev:client         # Frontend only â†’ http://localhost:60023
npm run dev:server         # Backend only â†’ http://localhost:3001

# Production
npm run build              # Build client for production
npm run build:client       # Build client only
```

See [quickstart.md](./quickstart.md) for detailed setup instructions.

---

## API Integration

The server acts as a proxy to OTOY.AI's REST API:

- **Endpoint Listing**: `GET http://localhost:3001/api/endpoints`
- **Model Execution**: `POST http://localhost:3001/api/execute` (planned)
- **Automatic Refresh**: Fetches latest models on startup

Original API: `https://play.otoy.ai/api/endpoints`

---

## Project & Workspace File Management

### Save & Load Files

**Save button** in the main toolbar **always opens a native file dialog** to save projects to your local file system:

- **Projects** (node graphs): Saved as `.otoyai` files
  - Contains: nodes, edges, connections, parameters, visible endpoints
  - File format: JSON
  - Example: `MyProject_1705823456789.otoyai`
  
- **Workspaces** (NodeBar configs): Saved as `.otoyai-workspace` files
  - Contains: visible endpoint configurations only
  - File format: JSON
  - Example: `workspace_1705823456789.otoyai-workspace`

### Where Files Are Stored

#### Browser Storage (localStorage)
- **Key**: `otoyai-storage`
- **Contents**: Recent projects and visible endpoint lists
- **Purpose**: Quick access to recent work
- **Location**: Browser's localStorage (not a real file)

#### File System (via Save button)
- **Location**: User's choice via native file dialog
- **Format**: JSON files with `.otoyai` or `.otoyai-workspace` extensions
- **Benefit**: Portable, version-controllable, shareable

### File System Access API

- **Modern browsers** (Chrome, Edge): Uses `showSaveFilePicker()` / `showOpenFilePicker()`
- **Fallback**: Automatic download/upload for older browsers
- **Security**: User explicitly chooses save location via OS dialog

### Quick Access

Even when saving to file system, projects are **also cached in localStorage** for the "Recent Projects" list visible when clicking the Load button's dropdown (planned feature).

---

## Logger System

Built-in file-based logging for development and debugging:

```typescript
import { logger } from './services/logger';

logger.info('Message', { data: value });
logger.error('Error occurred', error);
logger.debug('Debug info', { details });
```

- Logs saved to `server/logs/app.log`
- Cleared on app restart
- Accessible via toolbar "Reset" button

---

## Current Status

### âœ… Implemented
- Complete node graph system with React Flow
- Color-coded type-safe pin system (9 data types)
- Dynamic AI endpoint node generation from API
- Text, Image, Video utility nodes
- Left toolbar with Add/Clear/Reset buttons
- NodeBar (middle panel) with categorized AI models
- Node inspector (right panel) for parameter editing
- Real-time endpoint fetching from play.otoy.ai
- **Native file save/load dialogs** for projects (.otoyai files)
- **Workspace save/load** for NodeBar configurations (.otoyai-workspace files)
- localStorage caching for quick access to recent projects
- File-based logging system
- Production build pipeline
- CORS enabled for local development

### ğŸš§ In Progress
- Visual validation during connection drag
- Edge color matching pin types
- Actual API execution calls (POST to endpoints)
- Node result caching

### ğŸ“‹ Planned
- Recent projects dropdown in Load button
- Export results (download images/videos from executed nodes)
- Octane node for octaneWebR integration
- Batch processing
- Custom node templates
- Undo/redo system
- Node search/filter

---

## UI Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      â”‚             â”‚                                       â”‚             â”‚
â”‚  T   â”‚   NodeBar   â”‚        Node Graph Area               â”‚  Inspector  â”‚
â”‚  O   â”‚             â”‚                                       â”‚             â”‚
â”‚  O   â”‚  - Add      â”‚   (React Flow canvas)                â”‚  Selected   â”‚
â”‚  L   â”‚  - Clear    â”‚                                       â”‚  node       â”‚
â”‚  B   â”‚  - Reset    â”‚   Drag nodes, connect pins           â”‚  parameters â”‚
â”‚  A   â”‚             â”‚                                       â”‚             â”‚
â”‚  R   â”‚  Categories â”‚                                       â”‚  Edit       â”‚
â”‚      â”‚  - Text     â”‚                                       â”‚  values     â”‚
â”‚      â”‚  - Image    â”‚                                       â”‚             â”‚
â”‚      â”‚  - Video    â”‚                                       â”‚             â”‚
â”‚      â”‚  - AI Modelsâ”‚                                       â”‚             â”‚
â”‚      â”‚             â”‚                                       â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## License

MIT

---

## Quick Links

- **Installation**: [quickstart.md](./quickstart.md)
- **AI Context Loader**: [repro_prompt.md](./repro_prompt.md)
- **OTOY.AI Playground**: https://play.otoy.ai
- **Beta UI Reference**: https://beta.otoy.ai
- **React Flow Docs**: https://reactflow.dev
