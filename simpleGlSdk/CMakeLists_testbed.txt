cmake_minimum_required(VERSION 3.10)

# Testbed for callback debugging
project(callback_testbed)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Create the testbed executable
add_executable(callback_testbed
    callback_testbed.cpp
)

# Include directories
target_include_directories(callback_testbed
    PRIVATE
        ${CMAKE_SOURCE_DIR}/sdk
        ${CMAKE_SOURCE_DIR}/sdk/src/api/grpc/protodef
        ${CMAKE_SOURCE_DIR}/sdk/src/api/grpc/protoc
        ${CMAKE_SOURCE_DIR}/sdk/src/api/grpc
        ${CMAKE_SOURCE_DIR}/sdk/src/api/grpc/client
)

# Enable SDK integration
target_compile_definitions(callback_testbed PRIVATE DO_GRPC_SDK_ENABLED)

# Link libraries - minimal set for testing
target_link_libraries(callback_testbed
    PRIVATE
        octane_sdk
)

# Windows MSVC specific configurations
if(MSVC)
    # Set subsystem to console
    set_target_properties(callback_testbed PROPERTIES
        LINK_FLAGS "/SUBSYSTEM:CONSOLE"
    )
    
    # Set runtime library to match third_party libraries (static runtime)
    set_property(TARGET callback_testbed PROPERTY
        MSVC_RUNTIME_LIBRARY "MultiThreaded$<$<CONFIG:Debug>:Debug>")
    
    # Add /bigobj flag for large object files
    target_compile_options(callback_testbed PRIVATE /bigobj)
endif()

# Set working directory for debugging in Visual Studio
set_target_properties(callback_testbed PROPERTIES
    VS_DEBUGGER_WORKING_DIRECTORY "${CMAKE_SOURCE_DIR}/bin"
)